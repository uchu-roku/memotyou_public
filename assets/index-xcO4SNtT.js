(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();const h="theme",u="notepad_content",l="notepad_timestamp";function m(a){return typeof DOMException<"u"&&a instanceof DOMException}function r(a,e){try{return localStorage.setItem(a,e),{success:!0}}catch(t){return m(t)?{success:!1,error:t}:{success:!1,error:t}}}function d(a,e=null){try{const t=localStorage.getItem(a);return{success:!0,value:t!==null?t:e}}catch(t){return m(t)?{success:!1,value:e,error:t}:{success:!1,value:e,error:t}}}function i(a,e){e.success||console.warn(a,e.error)}function p(a){const e=r(h,a);return i("テーマ設定を保存できません: ストレージにアクセスできません。",e),e.success}function f(a){const e=d(h,a);return i("テーマ設定を読み込めません: ストレージにアクセスできません。",e),e.value}class g{constructor(){this.notepad=document.getElementById("notepad"),this.charCount=document.getElementById("charCount"),this.saveStatus=document.getElementById("saveStatus"),this.themeToggle=document.getElementById("themeToggle"),this.storageWarningIssued=!1,this.initTheme(),this.initEventListeners(),this.loadFromStorage(),this.updateCharCount()}initEventListeners(){document.getElementById("newBtn").addEventListener("click",()=>this.newNote()),document.getElementById("saveBtn").addEventListener("click",()=>this.saveNote()),document.getElementById("loadBtn").addEventListener("click",()=>this.loadNote()),document.getElementById("clearBtn").addEventListener("click",()=>this.clearNote()),this.themeToggle&&this.themeToggle.addEventListener("click",()=>this.toggleTheme()),this.notepad.addEventListener("input",()=>{this.updateCharCount(),this.updateSaveStatus("未保存","unsaved")}),document.addEventListener("keydown",e=>{e.ctrlKey&&e.key==="s"&&(e.preventDefault(),this.saveNote())}),setInterval(()=>{this.notepad.value.trim()!==""&&this.autoSave()},5e3)}initTheme(){const e=f(null),t=typeof window.matchMedia=="function"&&window.matchMedia("(prefers-color-scheme: dark)").matches,n=e||(t?"dark":"light");this.applyTheme(n)}toggleTheme(){const t=(document.documentElement.classList.contains("dark")?"dark":"light")==="light"?"dark":"light";this.applyTheme(t),p(t)}updateThemeToggleLabel(e){if(!this.themeToggle)return;const t=e==="dark";this.themeToggle.textContent=t?"ライトテーマ":"ダークテーマ",this.themeToggle.setAttribute("aria-pressed",String(t))}applyTheme(e){document.body.setAttribute("data-theme",e),document.documentElement.classList.toggle("dark",e==="dark"),this.updateThemeToggleLabel(e)}notifyStorageIssue(e,{force:t=!1}={}){(!this.storageWarningIssued||t)&&this.updateSaveStatus(e,"unsaved"),this.storageWarningIssued=!0}clearStorageNotice(){this.storageWarningIssued=!1}newNote(){this.notepad.value.trim()!==""?confirm("現在のメモを破棄して新規作成しますか？")&&(this.notepad.value="",this.updateCharCount(),this.updateSaveStatus("新規メモ","unsaved"),this.notepad.focus()):this.notepad.focus()}saveNote(){const e=this.notepad.value,t=new Date().toLocaleString("ja-JP"),n=r(u,e),s=r(l,t);i("メモの内容を保存できません: ストレージにアクセスできません。",n),i("保存日時を保存できません: ストレージにアクセスできません。",s),n.success&&s.success?(this.clearStorageNotice(),this.updateSaveStatus(`保存済み (${t})`,"saved")):this.notifyStorageIssue("ブラウザの設定でローカル保存がブロックされているため、ブラウザには保存できません。ファイルはダウンロードされました。",{force:!0}),this.downloadAsFile(e)}loadNote(){const e=document.createElement("input");e.type="file",e.accept=".txt",e.onchange=t=>{const n=t.target.files[0];if(n){const s=new FileReader;s.onload=o=>{this.notepad.value=o.target.result,this.updateCharCount(),this.updateSaveStatus("ファイル読み込み完了","saved")},s.readAsText(n)}},e.click()}clearNote(){confirm("メモをクリアしますか？")&&(this.notepad.value="",this.updateCharCount(),this.updateSaveStatus("クリア済み","saved"),this.notepad.focus())}downloadAsFile(e){const t=new Blob([e],{type:"text/plain;charset=utf-8"}),n=URL.createObjectURL(t),s=document.createElement("a"),o=new Date().toISOString().slice(0,19).replace(/:/g,"-");s.href=n,s.download=`memo_${o}.txt`,s.click(),URL.revokeObjectURL(n)}loadFromStorage(){const e=d(u,"");if(!e.success){i("メモの内容を読み込めません: ストレージにアクセスできません。",e),this.notifyStorageIssue("ローカル保存されたメモを読み込めません。ブラウザの設定をご確認ください。",{force:!0});return}if(e.value){this.notepad.value=e.value;const t=d(l,"");if(i("保存日時を読み込めません: ストレージにアクセスできません。",t),t.success&&t.value){this.clearStorageNotice(),this.updateSaveStatus(`保存済み (${t.value})`,"saved");return}}this.clearStorageNotice(),this.updateSaveStatus("保存済み","saved")}autoSave(){const e=this.notepad.value,t=new Date().toLocaleString("ja-JP"),n=r(u,e),s=r(l,t);if(i("自動保存でメモの内容を保存できませんでした。",n),i("自動保存で保存日時を保存できませんでした。",s),!n.success||!s.success){this.notifyStorageIssue("自動保存に失敗しました（ブラウザの設定でローカル保存がブロックされています）");return}this.clearStorageNotice()}updateCharCount(){const e=this.notepad.value.length;this.charCount.textContent=`${e}文字`}updateSaveStatus(e,t){this.saveStatus.textContent=e,this.saveStatus.className=t}}document.addEventListener("DOMContentLoaded",()=>{new g});
